# 个人日记Web应用MVP开发任务计划

## 项目概述
基于architecture.md的设计，将整个MVP项目分解为小而可测试的任务，每个任务专注于单一功能点。

## 开发原则
- **极其小巧**: 每个任务1-2小时内完成
- **可测试**: 每个任务都有明确的验收标准
- **单一关注点**: 每个任务只解决一个具体问题
- **渐进式**: 前一个任务为后一个任务奠定基础

---

## 阶段一：基础框架搭建 (Tasks 1-8)

### Task 1: 初始化项目结构
**目标**: 创建基本的项目目录结构
**开始条件**: 空项目目录
**结束条件**: 完整的目录结构已创建
**验收标准**:
- 所有目录按architecture.md创建完毕
- 所有`__init__.py`文件已创建
- 项目可以被Python识别为包

**具体产出**:
```
myblog/
├── app/
│   ├── __init__.py
│   ├── frontend/__init__.py
│   ├── admin/__init__.py
│   └── api/__init__.py
├── templates/
├── static/
└── 其他必要目录
```

### Task 2: 创建基础配置文件
**目标**: 设置项目基本配置
**开始条件**: Task 1完成
**结束条件**: 配置文件可以被正确加载
**验收标准**:
- `config.py`包含数据库、上传目录等基本配置
- 支持开发和生产环境切换
- 可以通过Python导入配置

**具体产出**:
- `config.py` - 主配置文件
- `app/config.py` - 应用内配置

### Task 3: 创建Flask应用工厂
**目标**: 实现Flask应用的创建和初始化
**开始条件**: Task 2完成
**结束条件**: Flask应用可以启动
**验收标准**:
- 创建python虚拟环境，并在虚拟环境中安装需要的依赖
- `app/__init__.py`包含create_app函数
- 可以启动基本的Flask应用
- 访问根路径返回"Hello World"

**具体产出**:
- `app/__init__.py` - 应用工厂函数
- `run.py` - 开发服务器启动文件

### Task 4: 集成SQLAlchemy
**目标**: 设置数据库连接
**开始条件**: Task 3完成
**结束条件**: 数据库连接正常
**验收标准**:
- SQLAlchemy正确初始化
- 可以连接到MySQL数据库
- 数据库连接测试通过

**具体产出**:
- 更新`app/__init__.py`集成SQLAlchemy
- 数据库连接测试代码

### Task 5: 设计数据库模型 - Article
**目标**: 创建文章模型
**开始条件**: Task 4完成
**结束条件**: Article模型可以创建和查询
**验收标准**:
- `models.py`包含Article类
- 所有字段按architecture.md定义
- 可以创建、查询Article记录

**具体产出**:
- `app/models.py` - Article模型定义

### Task 6: 设计数据库模型 - Tag和关联表
**目标**: 创建标签模型和文章标签关联
**开始条件**: Task 5完成
**结束条件**: Tag模型和多对多关系正常工作
**验收标准**:
- Tag模型完整定义
- Article-Tag多对多关系正确
- 可以为文章添加/删除标签

**具体产出**:
- 更新`app/models.py` - Tag模型和关联表

### Task 7: 设计数据库模型 - Admin和Config
**目标**: 创建管理员和配置模型
**开始条件**: Task 6完成
**结束条件**: 所有模型完整且可用
**验收标准**:
- Admin模型支持用户验证
- Config模型支持键值对存储
- 所有模型关系正确

**具体产出**:
- 更新`app/models.py` - Admin和Config模型

### Task 8: 数据库迁移和初始化
**目标**: 设置数据库迁移和初始数据
**开始条件**: Task 7完成
**结束条件**: 数据库表创建成功，有初始数据
**验收标准**:
- 所有表成功创建
- 有一个测试管理员账户（用户名：admin，密码：admin123）
- 有基本的系统配置数据（site_title, site_description等）

**具体实现步骤**:
1. 创建数据库表结构（使用SQLAlchemy的create_all()）
2. 创建初始管理员账户：
   - 用户名：admin
   - 密码：admin123（使用密码哈希存储）
   - 邮箱：admin@example.com
3. 初始化基本系统配置：
   - site_title: "我的个人博客" 
   - site_description: "记录生活，分享思考"
   - about_personal: "这里是个人介绍内容"
   - about_changelog: "版本更新日志"
   - about_diary: "随手日记内容"

**具体产出**:
- 数据库初始化脚本
- 可选：数据库迁移脚本（为将来扩展准备）

---

## 阶段二：前端基础页面 (Tasks 9-16)

### Task 9: 创建基础模板
**目标**: 建立前端模板基础结构
**开始条件**: Task 8完成
**结束条件**: 有可用的基础模板
**验收标准**:
- `templates/base.html`包含完整HTML结构
- 集成Bootstrap CSS框架
- 天空淡蓝色背景样式正确

**具体产出**:
- `templates/base.html` - 基础模板
- `static/css/style.css` - 主样式文件

### Task 10: 实现首页路由和视图
**目标**: 创建首页的后端逻辑
**开始条件**: Task 9完成
**结束条件**: 首页可以访问并显示基本内容
**验收标准**:
- `/`路由返回首页模板
- 可以获取文章列表数据
- 支持分页功能

**具体产出**:
- `app/frontend/views.py` - 首页视图函数
- `app/frontend/__init__.py` - 蓝图注册

### Task 11: 创建首页模板 - 基本布局
**目标**: 实现首页的HTML结构
**开始条件**: Task 10完成
**结束条件**: 首页显示正确的布局
**验收标准**:
- 欢迎语区域显示
- 导航栏（首页、关于）正确
- 左右两栏布局正确

**具体产出**:
- `templates/frontend/index.html` - 首页模板基础结构

### Task 12: 首页 - 文章列表时间线
**目标**: 实现文章列表的时间线展示
**开始条件**: Task 11完成
**结束条件**: 文章按时间线显示
**验收标准**:
- 左侧具有时间线样式，时间线可滑动且可以快速定位，支持筛选功能。
- 文章按时间倒序显示
- 显示文章标题、发布时间、文章标签、文章权限（公开或需要验证）、浏览数
- 如果文章需要验证，只显示“该文章需要验证问题后进行查看”，不显示实际内容
- 置顶文章优先显示

**具体产出**:
- 更新`templates/frontend/index.html` - 时间线组件
- 更新`app/frontend/views.py` - 文章查询逻辑

### Task 13: 首页 - 右侧功能区
**目标**: 实现右侧搜索和按标签筛选、按文章权限筛选功能
**开始条件**: Task 12完成
**结束条件**: 右侧功能区完整
**验收标准**:
- 标题搜索框可用
- Top文章按浏览量显示
- 标签分类筛选功能正常
- 按文章权限筛选功能正常
- 管理员登录入口存在

**具体产出**:
- 更新`templates/frontend/index.html` - 右侧功能区
- 搜索和筛选的JavaScript代码

### Task 14: 实现文章详情页路由
**目标**: 创建文章详情页的后端逻辑
**开始条件**: Task 13完成
**结束条件**: 文章详情页可以访问
**验收标准**:
- `/article/<id>`路由正常工作
- 支持文章权限验证
- 浏览数自动增加

**具体产出**:
- 更新`app/frontend/views.py` - 文章详情视图

### Task 15: 创建文章详情页模板
**目标**: 实现文章详情页面显示
**开始条件**: Task 14完成
**结束条件**: 文章内容正确显示
**验收标准**:
- 显示文章标题、时间、浏览数、权限、标签
- Markdown内容正确渲染
- 返回首页链接正常

**具体产出**:
- `templates/frontend/article.html` - 文章详情模板

### Task 16: 实现文章权限验证
**目标**: 创建需要验证的文章访问控制
**开始条件**: Task 15完成
**结束条件**: 权限验证流程完整
**验收标准**:
- 需要验证的文章弹出验证窗口，正确显示管理员提供的提示词和答案填写框。
- 填写答案框，验证成功后可以访问文章
- 验证失败给出提示

**具体产出**:
- `templates/frontend/verify.html` - 验证弹窗模板
- 验证逻辑的JavaScript代码


## 阶段四：管理员认证 (Tasks 17-19) ✅ 已完成

### Task 17: 创建管理员登录页面 ✅ 已完成
**目标**: 实现管理员登录界面
**开始条件**: Task 16完成
**结束条件**: 登录页面可以访问
**验收标准**:
- ✅ `/admin/login`路由正常
- ✅ 登录表单正确显示
- ✅ 基本样式美观

**具体产出**:
- ✅ `app/admin/views.py` - 登录路由
- ✅ `templates/admin/login.html` - 登录页模板
- ✅ `app/admin/forms.py` - 登录表单类

### Task 18: 实现登录验证逻辑 ✅ 已完成
**目标**: 完成用户身份验证
**开始条件**: Task 17完成
**结束条件**: 登录功能完全工作
**验收标准**:
- ✅ 用户名密码验证正确
- ✅ 登录状态正确保存
- ✅ 登录失败给出提示

**具体产出**:
- ✅ `app/auth.py` - 认证相关工具函数
- ✅ 更新`app/admin/views.py` - 登录验证逻辑

### Task 19: 实现登录装饰器和会话管理 ✅ 已完成
**目标**: 创建登录保护机制
**开始条件**: Task 18完成
**结束条件**: 后台页面需要登录才能访问
**验收标准**:
- ✅ 访问后台时，未登录用户自动跳转登录页
- ✅ 登录用户可以访问后台
- ✅ 登出功能正常

**具体产出**:
- ✅ 更新`app/auth.py` - 登录装饰器
- ✅ 登出路由和逻辑

---

## 阶段五：后台管理首页 (Tasks 20-21) ✅ 已完成

### Task 20: 创建后台管理首页 ✅ 已完成
**目标**: 实现后台管理的导航页面
**开始条件**: Task 19完成
**结束条件**: 后台首页可以访问
**验收标准**:
- ✅ `/admin/dashboard`显示管理功能列表
- ✅ 所有管理功能：文章管理，标签管理，欢迎语编辑，修改网页背景，修改密码入口存在
- ✅ 页面布局美观

**具体产出**:
- ✅ `templates/admin/base.html` - 后台基础模板
- ✅ `templates/admin/dashboard.html` - 后台首页

### Task 21: 安全性检查 ✅ 已完成
**目标**: 生产环境安全性检查
**开始条件**: Task 20完成
**结束条件**: 安全检查通过
**验收标准**:
- ✅ 当前不存在生产环境下的安全问题

**具体产出**:
- ✅ `static/css/admin.css` - 后台样式
- ✅ 导航组件和JavaScript

---

## 阶段六：文章管理 (Tasks 22-26) ✅ 已完成

### Task 22: 实现文章列表管理页 ✅ 已完成
**目标**: 创建文章管理的列表页面
**开始条件**: Task 21完成
**结束条件**: 可以查看文章列表
**验收标准**:
- ✅ `/admin/articles`显示所有文章
- ✅ 显示标题、创建时间、更新时间，标签、文章权限(公开或需要验证)、浏览数、状态(草稿或发布)
- ✅ 支持分页

**具体产出**:
- ✅ 更新`app/admin/views.py` - 文章列表视图
- ✅ `templates/admin/articles.html` - 文章管理页

### Task 23: 文章列表管理页实现文章删除功能 ✅ 已完成
**目标**: 文章列表管理页添加文章删除操作
**开始条件**: Task 22完成
**结束条件**: 可以删除选中的文章
**验收标准**:
- ✅ 支持单选和多选删除
- ✅ 删除前有确认提示
- ✅ 删除后刷新列表
- ✅ 删除后前端文章能正确不显示

**具体产出**:
- ✅ 更新`app/admin/views.py` - 删除逻辑
- ✅ 删除功能的JavaScript

### Task 24: 文章列表管理页实现文章状态切换 ✅ 已完成
**目标**: 文章列表管理页添加草稿/发布状态切换
**开始条件**: Task 23完成
**结束条件**: 可以切换文章状态
**验收标准**:
- ✅ 可以将文章设为草稿或发布
- ✅ 状态变更即时生效
- ✅ 前端状态显示正确

**具体产出**:
- ✅ 更新`app/admin/views.py` - 状态切换逻辑

### Task 25: 创建文章编辑页面 - 基础表单 ✅ 已完成
**目标**: 实现文章编辑的基本界面
**开始条件**: Task 24完成
**结束条件**: 文章编辑页面可以访问
**验收标准**:
- ✅ `/admin/article/edit/<id>`路由正常
- ✅ 显示文章编辑表单
- ✅ 标题和内容可以编辑

**具体产出**:
- ✅ 更新`app/admin/views.py` - 编辑页面视图
- ✅ `templates/admin/article_edit.html` - 编辑页模板
- ✅ 更新`app/admin/forms.py` - 文章编辑表单

### Task 26: 完善文章编辑功能 ✅ 已完成
**目标**: 实现完整的文章编辑功能
**开始条件**: Task 25完成
**结束条件**: 文章编辑功能完全可用
**验收标准**:
- ✅ 支持Markdown编辑
- ✅ 支持图片粘贴，排版
- ✅ 权限设置（公开/需要验证）
- ✅ 权限为需要验证时，弹出提示词编辑框和答案编辑框
- ✅ 文章标签选择功能
- ✅ 文章浏览数可自定义设置数字功能
- ✅ 置顶设置
- ✅ 保存为草稿/发布功能
- ✅ 编辑界面需要美观
- ✅ 文章管理页面中的新增文章按钮能够跳转到文章编辑功能

**具体产出**:
- ✅ Markdown编辑器集成
- ✅ 完整的编辑功能JavaScript
- ✅ 图片上传功能（基础版）
- ✅ 美观的编辑界面

---

## 阶段七：标签管理 (Tasks 27-28) ✅ 已完成

### Task 27: 实现标签管理页面 ✅ 已完成
**目标**: 创建标签的CRUD管理
**开始条件**: Task 26完成
**结束条件**: 标签管理功能完整
**验收标准**:
- ✅ `/admin/tags`显示所有标签
- ✅ 可以创建新标签
- ✅ 可以编辑标签名称和颜色
- ✅ 可以删除未使用的标签

**具体产出**:
- ✅ 更新`app/admin/views.py` - 标签管理视图
- ✅ `templates/admin/tags.html` - 标签管理页

### Task 28: 完善标签功能 ✅ 已完成
**目标**: 优化标签管理体验
**开始条件**: Task 27完成
**结束条件**: 标签功能用户体验良好,文章创建界面可正确处理已创建标签，修改后文章列表管理页和前端可显示。
**验收标准**:
- ✅ 标签颜色选择器
- ✅ 显示标签使用统计
- ✅ 删除标签时的安全检查
- ✅ 文章编辑页面实现已创建标签的选择功能,功能可正常关联上文章

**具体产出**:
- ✅ 标签颜色选择组件
- ✅ 标签使用统计功能
- ✅ 文章编辑页选择已创建标签功能实现,并且选择后可在标签管理页和前端正确显示

---

## 阶段八：系统设置 (Tasks 29-32) ✅ 已完成

### Task 29: 实现欢迎语编辑 ✅ 已完成
**目标**: 创建首页欢迎语的编辑功能
**开始条件**: Task 28完成
**结束条件**: 可以编辑首页欢迎语
**验收标准**:
- ✅ 可以修改首页欢迎语内容
- ✅ 修改后前端即时更新
- ✅ 支持简单的富文本编辑

**具体产出**:
- ✅ 更新`app/admin/views.py` - 欢迎语编辑
- ✅ `templates/admin/welcome_edit.html` - 欢迎语编辑页


### Task 30: 实现背景图片上传 ✅ 已完成
**目标**: 创建网页背景的设置功能
**开始条件**: Task 29完成
**结束条件**: 可以上传和设置背景图片
**验收标准**:
- ✅ 支持图片上传,且背景图片质量不损失
- ✅ 背景图片可虚化处理,虚化程度可以由管理员后端控制
- ✅ 背景图片自适应设置到前端首页，管理员后端页面无需改变。
- ✅ 背景图片要自适应到前端页面，不能让背景图片被截断。

**具体产出**:
- ✅ 更新`app/admin/views.py` - 背景设置
- ✅ `templates/admin/background_edit.html` - 背景设置页
- ✅ 图片处理工具函数

### Task 31: 实现密码修改 ✅ 已完成
**目标**: 创建管理员密码修改功能
**开始条件**: Task 30完成
**结束条件**: 管理员可以修改密码
**验收标准**:
- ✅ 旧密码验证
- ✅ 新密码强度检查
- ✅ 密码修改成功提示

**具体产出**:
- ✅ 更新`app/admin/views.py` - 密码修改
- ✅ `templates/admin/password_change.html` - 密码修改页

### Task 32: 系统设置整合和优化 ✅ 已完成
**目标**: 整合所有系统设置功能
**开始条件**: Task 31完成
**结束条件**: 系统设置功能完整统一
**验收标准**:
- ✅ 统一的设置导航
- ✅ 设置保存成功反馈
- ✅ 所有设置功能正常工作

**具体产出**:
- ✅ 系统设置导航优化
- ✅ 统一的成功/错误提示组件

---

## 阶段九：完善和优化 (Tasks 33-37)

### Task 33: 实现搜索功能
**目标**: 完善首页的搜索功能
**开始条件**: Task 32完成
**结束条件**: 文章搜索功能完全可用
**验收标准**:
- 支持标题关键词搜索
- 搜索结果正确显示
- 支持搜索结果分页

**具体产出**:
- 更新`app/frontend/views.py` - 搜索逻辑
- 搜索结果页面和样式

### Task 34: 实现筛选功能
**目标**: 完善按标签和类型的筛选
**开始条件**: Task 33完成
**结束条件**: 筛选功能完全可用
**验收标准**:
- 按标签筛选文章
- 按权限类型筛选
- 筛选条件可以组合

**具体产出**:
- 筛选逻辑的JavaScript
- 筛选UI组件优化

<!-- ### Task 35: 添加基础测试
**目标**: 为核心功能添加测试
**开始条件**: Task 34完成
**结束条件**: 主要功能有测试覆盖
**验收标准**:
- 模型测试
- 主要视图测试
- 认证功能测试 -->

<!-- **具体产出**:
- `tests/` 目录和测试文件
- 基础测试用例 -->

### Task 36: 错误处理和用户体验优化
**目标**: 完善错误处理和用户提示
**开始条件**: Task 34完成（跳过Task 35）
**结束条件**: 用户体验流畅
**验收标准**:
- 404、500错误页面
- 表单验证提示
- 操作成功/失败反馈

**具体产出**:
- ✅ 错误页面模板（404、500）
- ✅ 统一的消息提示组件
- ✅ 表单验证增强组件
- ✅ Toast消息提示功能

**已完成功能**:
1. 404页面未找到错误处理 - 美观的错误页面，支持返回首页和返回上页
2. 500服务器内部错误处理 - 友好的错误页面，支持刷新和返回首页  
3. 统一的Flash消息提示组件 - 支持成功、错误、警告、信息等多种类型
4. JavaScript Toast消息功能 - 动态弹出式提示，支持自动消失
5. 表单验证增强 - 实时验证、密码强度检查、友好的错误提示
6. 消息组件样式优化 - 带图标、动画效果、毛玻璃背景

### Task 37: 性能优化和准备部署
**目标**: 优化性能，准备生产部署
**开始条件**: Task 36完成
**结束条件**: 应用可以部署到生产环境
**验收标准**:
- ✅ 静态文件压缩
- ✅ 数据库查询优化
- ✅ 生产配置就绪

**具体产出**:
- ✅ `requirements.txt` 最终版本 - 添加了gunicorn和Flask-Compress
- ✅ `wsgi.py` 生产入口 - 生产环境WSGI应用入口
- ✅ 部署相关配置文件 - Nginx、Supervisor、Gunicorn配置
- ✅ 自动化部署脚本 - `deploy.sh`和监控脚本
- ✅ 性能优化 - 静态文件压缩、数据库连接池、查询优化

**已完成的性能优化**:
1. **静态文件压缩** - 集成Flask-Compress，支持gzip压缩
2. **数据库查询优化** - 使用joinedload预加载关联数据，减少N+1查询
3. **数据库连接池** - 配置连接池参数，提高并发性能
4. **Nginx优化** - 静态文件缓存、Gzip压缩、安全头配置
5. **Gunicorn配置** - 多进程、工作进程优化、日志配置
6. **部署自动化** - 一键部署脚本和系统监控

---

## 阶段十：部署和上线 

##提供生产环境部署主机的信息
ip: 43.142.171.111
域名： www.rlj.net.cn
配置：2C2G50GB SSD
部署用户: myblog
部署文件夹:/home/myblog/record_log
SSL\https文件位置：
- /etc/nginx/rlj.net.cn_bundle.crt
- /etc/nginx/rlj.net.cn.key  
mysql用户:blog_user
用户密码:%5E%28withrlj%40%40%23blog35%24%25RLJTTES1%21s
真实DATABASE_URL:DATABASE_URL='mysql+pymysql://blog_user:%5E%28withrlj%40%40%23blog35%24%25RLJTTES1%21s@localhost:3306/record_log?charset=utf8mb4'

### task38-1 生产环境部署 ✅ 已完成
目标：生产部署完成，通过www.rlj.net.cn可访问。
注意：一切按照生产环境的安全要求处理，不使用明文变量。

**已完成任务**:
- ✅ 使用服务器信息更新生产配置文件
  - 更新config.py中的数据库用户名从myblog_user2改为blog_user
  - 更新数据库名从myblog改为record_log
  - 更新Nginx配置，添加完整的SSL HTTPS支持
  - 配置HTTP到HTTPS的自动重定向

- ✅ 检查并修复生产环境部署问题
  - 修复config.py中的数据库连接配置
  - 确保所有配置文件使用正确的用户名和数据库名
  - 配置完整的SSL证书路径（/etc/nginx/rlj.net.cn_bundle.crt等）

- ✅ 更新.gitignore确保安全
  - 添加SSL证书和密钥文件保护
  - 添加环境变量和秘密文件保护
  - 添加上传目录和日志文件保护
  - 添加生产配置文件保护

- ✅ 创建生产部署文档production.md
  - 完整的部署步骤指南
  - 服务器配置说明
  - 监控和维护指南
  - 故障排除方案

- ✅ 删除冗余文件
  - 删除templates/admin/password_help.html（避免暴露管理员重置方法）

**部署准备就绪**:
1. 配置文件已更新匹配真实服务器信息
2. SSL HTTPS配置完整
3. 安全性检查通过
4. 部署文档完整
5. 所有敏感信息已保护

### Task 38: 准备部署配置
**目标**: 创建生产环境的配置文件
**开始条件**: Task 37完成
**结束条件**: 所有部署配置文件就绪
**验收标准**:
- Nginx配置文件
- Supervisor配置
- 部署脚本

**具体产出**:
- `deploy/nginx.conf`
- `deploy/supervisor.conf`
- `deploy/deploy.sh`

### Task 39: 本地部署测试
**目标**: 在本地环境模拟生产部署
**开始条件**: Task 38完成
**结束条件**: 本地生产环境测试通过
**验收标准**:
- 应用在生产模式下正常运行
- 静态文件服务正常
- 数据库连接正常

**具体产出**:
- 本地部署测试报告
- 部署问题修复

### Task 40: 生产环境部署
**目标**: 在Ubuntu服务器上完成部署
**开始条件**: Task 39完成
**结束条件**: 应用可以通过域名正常访问
**验收标准**:
- 通过 www.rlj.net.cn 可以访问应用
- 所有功能正常工作
- SSL证书配置（可选）

**具体产出**:
- 生产环境部署完成
- 部署文档和运维指南

---

## 任务执行规则

1. **逐个执行**: 严格按照任务序号执行，不可跳跃
2. **测试驱动**: 每个任务完成后必须通过验收标准测试
3. **渐进构建**: 后续任务依赖前面任务的成果
4. **单一关注**: 每次只专注于当前任务的具体目标
5. **及时反馈**: 每个任务完成后需要确认才能进行下一个

## 预计时间安排

- **阶段一-二**: 基础框架和前端页面 (Tasks 1-18) - 预计12-15小时
- **阶段三-五**: 认证和后台基础 (Tasks 19-23) - 预计8-10小时  
- **阶段六-八**: 管理功能实现 (Tasks 24-35) - 预计15-20小时
- **阶段九-十**: 优化和部署 (Tasks 36-43) - 预计10-12小时

**总计**: 约45-57小时，适合分散在1-2周内完成

---

每个任务都经过精心设计，确保：
✅ 可以独立完成和测试  
✅ 有明确的开始和结束条件  
✅ 专注于单一功能点  
✅ 为下一步奠定基础 